!function(e){"use strict";e.module("app",["ui.router","ui.mask","ngStorage"]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("authentication",{url:"/",templateUrl:"templates/login_or_signup.html"}).state("addPastebin",{url:"/add_pastebin",templateUrl:"templates/one_pastebin.html",controller:"AddPastebinController",controllerAs:"ctrl",resolve:{LanguagesData:["langService",function(e){return e.promise}]}}).state("pastebinList",{url:"/pastebin_list",templateUrl:"templates/pastebin_list.html",controller:"PastebinListController",controllerAs:"ctrl"}).state("usersPastebin",{url:"/users_pastebin/{id:int}",templateUrl:"templates/pastebin_list.html",controller:"PastebinListController",controllerAs:"ctrl"}).state("editPastebin",{url:"/edit_pastebin/{id:int}",templateUrl:"templates/one_pastebin.html",controller:"EditPastebinController",controllerAs:"ctrl",resolve:{LanguagesData:["langService",function(e){return e.promise}],Pastebin:["$stateParams","pastebinService",function(e,t){return t.getPastebin(e.id)}]}}),t.otherwise("/")}])}(angular),function(e){"use strict";e.module("app").controller("AppController",["userService","$scope","$state","$localStorage",function(e,t,n,r){var a=this;a.userid=function(){var t=e.getUserId();return t},a.isUserLogged=function(){return e.getUserId()>=0},a.logout=function(){e.logout(),n.go("authentication")},void 0!==r.id&&e.login(r.id)}])}(angular),function(e){"use strict";e.module("app").constant("REST_END_POINT","http://localhost:3000")}(angular),function(e){"use strict";e.module("app").controller("AddPastebinController",["langService","userService","pastebinService","$state",function(e,t,n,r){var a=this;a.pastebin={username:t.getUsername(),user_id:t.getUserId(),code:""},a.buttonText="Add pastebin",a.cancelText="Cancel",a.languages=e.getLanguages(),a.selectedLanguage=a.languages[0],a.buttonAction=function(){a.pastebin.date=new Date,a.pastebin.lang_id=a.selectedLanguage.id,a.pastebin.language=a.selectedLanguage.name,n.addPastebin(a.pastebin).then(function(){r.go("pastebinList")})},a.cancelAction=function(){r.go("pastebinList")}}])}(angular),function(e){"use strict";e.module("app").controller("EditPastebinController",["langService","userService","Pastebin","$stateParams","pastebinService","$state",function(e,t,n,r,a,s){var i=this;i.pastebin=n,i.buttonText="Edit pastebin",i.cancelText="Cancel",i.languages=e.getLanguages(),i.selectedLanguage=e.getLanguageById(i.pastebin.lang_id),i.buttonAction=function(){i.pastebin.lang_id=i.selectedLanguage.id,i.pastebin.language=i.selectedLanguage.name,a.updatePastebin(i.pastebin,i.pastebin.id).then(function(){s.go("pastebinList")})},i.cancelAction=function(){s.go("pastebinList")}}])}(angular),function(e){"use strict";e.module("app").controller("PastebinListController",["pastebinService","userService","$state","$scope","$timeout","$stateParams",function(e,t,n,r,a,s){var i=this,u=s.id,o=function(e){return("0"+e.getDate()).slice(-2)+("0"+(e.getMonth()+1)).slice(-2)+e.getFullYear()};e.getPastebins(u).then(function(e){i.pastebins=e,i.displayPastebins=[],i.pastebins.forEach(function(e,t){i.displayPastebins.push({dateInString:o(new Date(e.date)),pastebin:e,list_id:t})})}),i.isErasable=function(e){return e.user_id===t.getUserId()&&void 0!==u&&null!==u},i.isEditable=function(e){return e.user_id===t.getUserId()&&void 0!==u&&null!==u},i.removePastebin=function(t,n){var r=e.deletePastebin(t);r.then(function(){i.displayPastebins.splice(n,1)})},i.edit=function(e){n.go("editPastebin",{id:e.id})};r.$watch("ctrl.dateFilter",function(e){var t=null,n=null;e&&8===e.length&&(t=new Date(e.substring(4,9),e.substring(2,4)-1,e.substring(0,2)),n=("0"+t.getDate()).slice(-2)+("0"+(t.getMonth()+1)).slice(-2)+t.getFullYear(),n!==e&&a(function(){i.dateFilter=n}))});i.fulltextFilter=function(e){var t,n,r,a;return i.textFilter?(t=i.textFilter.toLowerCase,n=String(e.pastebin.username).toLowerCase(),r=String(e.pastebin.language).toLowerCase(),a=String(e.pastebin.code).toLowerCase(),-1!==n.indexOf(i.textFilter)||-1!==r.indexOf(i.textFilter)||-1!==a.indexOf(i.textFilter)?!0:!1):!0}}])}(angular),function(e){"use strict";e.module("app").controller("UserController",["userService","$state",function(e,t){var n=this;this.user={username:"",password:""},n.signup=function(){e.registerUser(n.user.username,n.user.password).then(function(e){n.message=e.textMessage,n.message||t.go("pastebinList"),n.user.username="",n.user.password="",n.repeatedPassword=""})},n.login=function(){e.loginUser(n.user.username,n.user.password).then(function(e){n.message=e.textMessage,n.message||t.go("pastebinList"),n.user.username="",n.user.password=""})}}])}(angular),function(e){"use strict";e.module("app").directive("repeatPass",[function(){return{require:"ngModel",restrict:"A",scope:{value:"=repeatPass"},link:function(e,t,n,r){r.$validators.repeatPass=function(t){return t===e.value},e.$watch("value",function(){r.$validate()})}}}])}(angular),function(e){"use strict";e.module("app").factory("langService",["$http","$log","REST_END_POINT",function(e,t,n){var r=null,a=e({method:"GET",url:n+"/langs"}).then(function(e){r=e.data},function(e){t.error("Request Failed: "+e)}),s=function(){return r},i=function(e){return r.filter(function(t){return t.id===e})[0]};return{promise:a,getLanguages:s,getLanguageById:i}}])}(angular),function(e){"use strict";e.module("app").factory("pastebinService",["$http","$log","REST_END_POINT",function(e,t,n){var r=function(r){return e({method:"GET",url:n+"/pastebins/"+r}).then(function(e){return t.log(e),e.data},function(e){t.error("Request Failed: "+e)})},a=function(r){return e({method:"POST",url:n+"/pastebins/",data:r}).then(function(e){return t.log(e),e.data},function(e){t.error("Request Failed: "+e)})},s=function(r,a){return e({method:"PUT",url:n+"/pastebins/"+a,data:r}).then(function(e){return t.log(e),e.data},function(e){t.error("Request Failed: "+e)})},i=function(r){return e({method:"DELETE",url:n+"/pastebins/"+r}).then(function(e){return t.log(e),e},function(e){t.error("Request Failed: "+e)})},u=function(){return e({method:"GET",url:n+"/pastebins/"}).then(function(e){return t.log(e),e.data},function(e){t.error("Request Failed: "+e)})},o=function(r){return e({method:"GET",url:n+"/pastebins/",params:{user_id:r}}).then(function(e){return t.log(e.data),e.data},function(e){t.error("Request Failed: "+e)})},l=function(e){return console.log("user id"),console.log(e),null!==e&&void 0!==e?o(e):u()};return{getPastebin:r,addPastebin:a,updatePastebin:s,deletePastebin:i,getPastebins:l}}])}(angular),function(e){"use strict";e.module("app").factory("userService",["$http","$log","REST_END_POINT","$localStorage",function(e,t,n,r){var a=this;a.user=null;var s=function(r){return e({method:"GET",url:n+"/users/"+r}).then(function(e){a.user=e.data},function(e){t.error("Request Failed: "+e)})},i=function(s,i){return e({method:"GET",url:n+"/users/",params:{username:s,password:i}}).then(function(e){return e.data&&e.data[0]?(a.user=e.data[0],r.id=l(),a.user):{textMessage:"Wrong username or password"}},function(e){t.error("Request Failed: "+e)})},u=function(){r.$reset(),a.user=null},o=function(){return a.user.username},l=function(){return a.user?a.user.id:-1},c=function(){return Boolean(a.user.is_admin)},d=function(r,a){return e({method:"POST",url:n+"/users/",data:{username:r,password:a,is_admin:!1}}).then(function(e){return e},function(e){t.error("Request Failed: "+e)})},g=function(r,a){var s=this;return s.login=String(r),s.password=String(a),e({method:"GET",url:n+"/users/",params:{username:r}}).then(function(e){return 0===e.data.length?d(s.login,s.password).then(i(s.login,s.password)):{textMessage:"User with this login already exist"}},function(e){t.error("Request Failed: "+e)})};return{getUsername:o,getUserId:l,isAdmin:c,login:s,logout:u,registerUser:g,loginUser:i}}])}(angular);